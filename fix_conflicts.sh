#!/bin/bash

echo "=== –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –†–ï–®–ï–ù–ò–ï –ö–û–ù–§–õ–ò–ö–¢–û–í ==="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
if git status --porcelain | grep -q "^UU\|^AA\|^DD"; then
    echo "–ù–∞–π–¥–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã. –ù–∞—á–∏–Ω–∞–µ–º –∏—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ..."
    echo ""
    
    # –†–µ—à–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ web/app.py
    echo "1. –†–µ—à–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ web/app.py..."
    if [ -f "web/app.py" ]; then
        # –£–¥–∞–ª—è–µ–º –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
        sed -i '/^<<<<<<< HEAD$/,/^=======$/d' web/app.py
        sed -i '/^>>>>>>> /d' web/app.py
        echo "‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ web/app.py —Ä–∞–∑—Ä–µ—à–µ–Ω—ã"
    fi
    
    # –†–µ—à–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ —à–∞–±–ª–æ–Ω–∞—Ö
    echo "2. –†–µ—à–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ —à–∞–±–ª–æ–Ω–∞—Ö..."
    
    if [ -f "web/templates/admin_users.html" ]; then
        sed -i '/^<<<<<<< HEAD$/,/^=======$/d' web/templates/admin_users.html
        sed -i '/^>>>>>>> /d' web/templates/admin_users.html
        echo "‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ admin_users.html —Ä–∞–∑—Ä–µ—à–µ–Ω—ã"
    fi
    
    if [ -f "web/templates/user_location.html" ]; then
        sed -i '/^<<<<<<< HEAD$/,/^=======$/d' web/templates/user_location.html
        sed -i '/^>>>>>>> /d' web/templates/user_location.html
        echo "‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ user_location.html —Ä–∞–∑—Ä–µ—à–µ–Ω—ã"
    fi
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    echo "3. –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ git..."
    git add .
    
    # –§–∏–∫—Å–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    echo "4. –§–∏–∫—Å–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
    git commit -m "Resolve merge conflicts and preserve security updates"
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    echo "5. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä..."
    git push
    
    echo ""
    echo "üéâ –í—Å–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã!"
    echo ""
    echo "–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
    echo "1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: ./restart_web_app.sh"
    echo "2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: tail -f driver-bot.log"
    echo "3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –æ—Ç–∫—Ä–æ–π—Ç–µ /test_security –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
    
else
    echo "–ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –í—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ!"
fi 