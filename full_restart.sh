#!/bin/bash

echo "๐ ะะพะปะฝะฐั ะฟะตัะตะทะฐะณััะทะบะฐ ัะตัะฒะตัะฐ..."

ssh root@194.87.236.174 << 'EOF'
    echo "๐ ะะตัะตัะพะดะธะผ ะฒ ะดะธัะตะบัะพัะธั ะฟัะพะตะบัะฐ..."
    cd /opt/driver-bot
    
    echo "๐ฅ ะะฑะฝะพะฒะปัะตะผ ะบะพะด..."
    git pull origin main
    
    echo "๐ ะัะพะฒะตััะตะผ ะฒัะต Python ะฟัะพัะตััั..."
    ps aux | grep python | grep -v grep
    
    echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะะกะ Python ะฟัะพัะตััั..."
    pkill -f python || echo "ะะตั ะฟัะพัะตััะพะฒ ะดะปั ะพััะฐะฝะพะฒะบะธ"
    
    echo "โณ ะะดะตะผ ะฟะพะปะฝะพะน ะพััะฐะฝะพะฒะบะธ..."
    sleep 5
    
    echo "๐งน ะัะธัะฐะตะผ ะบัั..."
    find . -name "*.pyc" -delete 2>/dev/null || true
    find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
    
    echo "๐ ะะฐะฟััะบะฐะตะผ ะฒะตะฑ-ัะตัะฒะตั..."
    nohup python run_web.py > web.log 2>&1 &
    
    echo "๐ค ะะฐะฟััะบะฐะตะผ ะฑะพัะฐ..."
    nohup python run_bot.py > bot.log 2>&1 &
    
    echo "โณ ะะดะตะผ ะทะฐะฟััะบะฐ..."
    sleep 5
    
    echo "๐ ะัะพะฒะตััะตะผ ะฟัะพัะตััั..."
    ps aux | grep python | grep -v grep
    
    echo "๐ ะขะตััะธััะตะผ ะฒะตะฑ-ัะตัะฒะตั..."
    curl -s http://localhost:5000/test || echo "ะะตะฑ-ัะตัะฒะตั ะฝะต ะพัะฒะตัะฐะตั"
    
    echo "โ ะะตัะตะทะฐะณััะทะบะฐ ะทะฐะฒะตััะตะฝะฐ!"
EOF

echo "๐ ะกะตัะฒะตั ะฟะตัะตะทะฐะณััะถะตะฝ!" 