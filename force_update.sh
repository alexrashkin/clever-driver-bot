#!/bin/bash

echo "üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞..."

ssh root@194.87.236.174 << 'EOF'
    echo "üìÅ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞..."
    cd /opt/driver-bot
    
    echo "üì• –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥..."
    git pull origin main
    
    echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã..."
    ps aux | grep python | grep -v grep
    
    echo "üõë –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ Python –ø—Ä–æ—Ü–µ—Å—Å—ã..."
    pkill -f "python.*run_web.py" || echo "–í–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω"
    pkill -f "python.*run_bot" || echo "–ë–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"
    
    echo "‚è≥ –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏..."
    sleep 5
    
    echo "üßπ –û—á–∏—â–∞–µ–º –∫—ç—à Python..."
    find . -name "*.pyc" -delete
    find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
    
    echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä..."
    nohup python run_web.py > web.log 2>&1 &
    
    echo "ü§ñ –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞..."
    nohup python run_bot.py > bot.log 2>&1 &
    
    echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞..."
    sleep 5
    
    echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã..."
    ps aux | grep python | grep -v grep
    
    echo "üåê –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ..."
    curl -s http://localhost:5000/test || echo "–í–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"
    
    echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
EOF

echo "üéâ –°–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!" 