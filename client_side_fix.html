<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f7fa;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        #log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .status-display {
            font-size: 18px;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        .status-on { background: #d4edda; color: #155724; }
        .status-off { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã</h1>
    
    <div class="test-section">
        <h3>üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞</h3>
        <div id="current-status" class="status-display">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button onclick="checkStatus()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
    </div>

    <div class="test-section">
        <h3>üß™ –¢–µ—Å—Ç—ã –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã</h3>
        <button onclick="testApiStability()">1Ô∏è‚É£ –¢–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ API</button>
        <button onclick="testPageReload()">2Ô∏è‚É£ –¢–µ—Å—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</button>
        <button onclick="testJavaScriptErrors()">3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ JS –æ—à–∏–±–æ–∫</button>
        <button onclick="testBrowserCache()">4Ô∏è‚É£ –¢–µ—Å—Ç –∫–µ—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞</button>
        <button onclick="clearAllCache()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à</button>
    </div>

    <div class="test-section">
        <h3>üìù –õ–æ–≥ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</h3>
        <div id="log"></div>
        <button onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        <button onclick="downloadLog()">üíæ –°–∫–∞—á–∞—Ç—å –ª–æ–≥</button>
    </div>

    <div class="test-section">
        <h3>üí° –ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3>
        <button onclick="hardRefresh()">üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ (Ctrl+Shift+R)</button>
        <button onclick="openIncognito()">üïµÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ</button>
        <button onclick="checkExtensions()">üîå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π</button>
    </div>

    <script>
        let logData = [];
        
        function log(message, level = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${level.toUpperCase()}: ${message}`;
            logData.push(logEntry);
            
            const logDiv = document.getElementById('log');
            const logLine = document.createElement('div');
            logLine.className = level;
            logLine.textContent = logEntry;
            logDiv.appendChild(logLine);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            logData = [];
        }

        function downloadLog() {
            const logText = logData.join('\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `diagnostics_${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function checkStatus() {
            try {
                log('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ API...');
                const response = await fetch('https://cleverdriver.ru/api/status');
                const data = await response.json();
                
                const statusDiv = document.getElementById('current-status');
                const isActive = data.tracking_active || data.tracking;
                
                statusDiv.textContent = `–ê–≤—Ç–æ–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ: ${isActive ? '–í–∫–ª—é—á–µ–Ω–æ' : '–í—ã–∫–ª—é—á–µ–Ω–æ'}`;
                statusDiv.className = `status-display ${isActive ? 'status-on' : 'status-off'}`;
                
                log(`‚úÖ –°—Ç–∞—Ç—É—Å –ø–æ–ª—É—á–µ–Ω: ${isActive}`, 'success');
                return isActive;
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ${error.message}`, 'error');
                return null;
            }
        }

        async function testApiStability() {
            log('üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ API...');
            const statuses = [];
            
            for (let i = 1; i <= 10; i++) {
                try {
                    const response = await fetch('https://cleverdriver.ru/api/status');
                    const data = await response.json();
                    const status = data.tracking_active || data.tracking;
                    statuses.push(status);
                    log(`API –∑–∞–ø—Ä–æ—Å ${i}/10: ${status}`);
                    await new Promise(resolve => setTimeout(resolve, 500));
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ ${i}: ${error.message}`, 'error');
                    statuses.push(null);
                }
            }
            
            const uniqueStatuses = [...new Set(statuses.filter(s => s !== null))];
            if (uniqueStatuses.length === 1) {
                log(`‚úÖ API —Å—Ç–∞–±–∏–ª–µ–Ω: –≤—Å–µ–≥–¥–∞ ${uniqueStatuses[0]}`, 'success');
            } else {
                log(`‚ùå API –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω: –Ω–∞–π–¥–µ–Ω—ã —Å—Ç–∞—Ç—É—Å—ã ${uniqueStatuses.join(', ')}`, 'error');
            }
        }

        async function testPageReload() {
            log('üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –≤–ª–∏—è–Ω–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏...');
            
            for (let i = 1; i <= 5; i++) {
                const statusBefore = await checkStatus();
                
                log(`–ò–º–∏—Ç–∞—Ü–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ ${i}/5...`);
                
                // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ –∑–∞–≥—Ä—É–∑–∫—É –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                try {
                    await fetch('https://cleverdriver.ru/');
                    await new Promise(resolve => setTimeout(resolve, 1000));
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ${error.message}`, 'error');
                }
                
                const statusAfter = await checkStatus();
                
                if (statusBefore === statusAfter) {
                    log(`‚úÖ –¢–µ—Å—Ç ${i}: —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–±–∏–ª–µ–Ω (${statusBefore} ‚Üí ${statusAfter})`, 'success');
                } else {
                    log(`‚ùå –¢–µ—Å—Ç ${i}: —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è! (${statusBefore} ‚Üí ${statusAfter})`, 'error');
                }
                
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
        }

        function testJavaScriptErrors() {
            log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ JavaScript –æ—à–∏–±–æ–∫...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏ (—ç—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Å–ø–æ—Å–æ–±)
            const originalConsoleError = console.error;
            const errors = [];
            
            console.error = function(...args) {
                errors.push(args.join(' '));
                originalConsoleError.apply(console, args);
            };
            
            setTimeout(() => {
                console.error = originalConsoleError;
                if (errors.length === 0) {
                    log('‚úÖ JavaScript –æ—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ', 'success');
                } else {
                    log(`‚ùå –ù–∞–π–¥–µ–Ω–æ ${errors.length} JavaScript –æ—à–∏–±–æ–∫:`, 'error');
                    errors.forEach(error => log(`   - ${error}`, 'error'));
                }
            }, 3000);
            
            log('–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –∑–∞–ø—É—â–µ–Ω –Ω–∞ 3 —Å–µ–∫—É–Ω–¥—ã...');
        }

        function testBrowserCache() {
            log('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            const localStorageKeys = Object.keys(localStorage);
            log(`localStorage –∫–ª—é—á–µ–π: ${localStorageKeys.length}`);
            if (localStorageKeys.length > 0) {
                log(`–ö–ª—é—á–∏: ${localStorageKeys.join(', ')}`);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º sessionStorage
            const sessionStorageKeys = Object.keys(sessionStorage);
            log(`sessionStorage –∫–ª—é—á–µ–π: ${sessionStorageKeys.length}`);
            if (sessionStorageKeys.length > 0) {
                log(`–ö–ª—é—á–∏: ${sessionStorageKeys.join(', ')}`);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º cookies
            const cookies = document.cookie.split(';').length;
            log(`Cookies: ${cookies} —à—Ç—É–∫`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à-–∑–∞–≥–æ–ª–æ–≤–∫–∏
            fetch('https://cleverdriver.ru/', { cache: 'no-cache' })
                .then(response => {
                    log(`Cache-Control: ${response.headers.get('Cache-Control') || '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}`);
                    log(`ETag: ${response.headers.get('ETag') || '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}`);
                    log(`Last-Modified: ${response.headers.get('Last-Modified') || '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}`);
                })
                .catch(error => log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤: ${error.message}`, 'error'));
        }

        function clearAllCache() {
            log('üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞...');
            
            // –û—á–∏—â–∞–µ–º localStorage
            try {
                localStorage.clear();
                log('‚úÖ localStorage –æ—á–∏—â–µ–Ω', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ localStorage: ${error.message}`, 'error');
            }
            
            // –û—á–∏—â–∞–µ–º sessionStorage
            try {
                sessionStorage.clear();
                log('‚úÖ sessionStorage –æ—á–∏—â–µ–Ω', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ sessionStorage: ${error.message}`, 'error');
            }
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å –æ—á–∏—Å—Ç–∫–æ–π –∫–µ—à–∞
            log('üîÑ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å Ctrl+Shift+R', 'warning');
        }

        function hardRefresh() {
            log('üîÑ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏...');
            location.reload(true);
        }

        function openIncognito() {
            log('üïµÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ:', 'info');
            log('1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤–æ–µ –æ–∫–Ω–æ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ (Ctrl+Shift+N)', 'info');
            log('2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://cleverdriver.ru', 'info');
            log('3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ª–∏ –ø—Ä–æ–±–ª–µ–º–∞', 'info');
            log('4. –ï—Å–ª–∏ –≤ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –∏—Å—á–µ–∑–∞–µ—Ç - —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –∫–µ—à–∞/—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π', 'info');
        }

        function checkExtensions() {
            log('üîå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞:', 'info');
            log('1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (chrome://extensions/)', 'info');
            log('2. –û—Ç–∫–ª—é—á–∏—Ç–µ –≤—Å–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–æ –æ—á–µ—Ä–µ–¥–∏', 'info');
            log('3. –ü–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–∞–π—Ç', 'info');
            log('4. –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∏ —Ä–µ–∫–ª–∞–º—ã –∏ VPN', 'info');
            log('5. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –º–æ–≥—É—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å JavaScript –∫–æ–¥', 'info');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('üöÄ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            checkStatus();
        };
    </script>
</body>
</html> 